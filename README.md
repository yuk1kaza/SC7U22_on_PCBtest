# SC7U22 IMU 原始数据测试

## 📝 项目简介

本项目是一个基于 Arduino 的 SC7U22 IMU 传感器原始数据采集和测试程序。SC7U22 是一款高性能 6 轴 IMU，集成了 3 轴加速度计和 3 轴陀螺仪，支持 SPI 通信接口。

## 🔧 硬件支持

### 支持的主控芯片
- ESP32-C3
- ESP32-C5
- ESP32-C6

### SC7U22 传感器规格
- **加速度计**: ±8G 量程，1600Hz 采样率
- **陀螺仪**: ±2000°/s 量程，1600Hz 采样率
- **通信接口**: SPI (8MHz)
- **芯片 ID**: 0x6A

## 📌 引脚配置

| 主控芯片 | MOSI | MISO | SCK | CS  |
|---------|------|------|-----|-----|
| ESP32-C3 | GPIO7 | GPIO2 | GPIO6 | GPIO10 |
| ESP32-C5 | GPIO6 | GPIO2 | GPIO7 | GPIO10 |
| ESP32-C6 | GPIO19 | GPIO20 | GPIO18 | GPIO10 |

### 硬件连接
| SC7U22 引脚 | 功能 | 主控引脚 |
|-----------|------|---------|
| SDI | MOSI | 参见上表 |
| SDO | MISO | 参见上表 |
| SCK | 时钟 | 参见上表 |
| CS  | 片选 | 参见上表 |
| VCC | 电源 | 3.3V |
| GND | 地 | GND |

**⚠️ 注意**: MISO 引脚需要启用内部上拉电阻（代码中已配置）。

## 🚀 使用方法

### 1. 选择目标主控芯片

在代码开头找到以下区域，取消注释你要使用的芯片：

```cpp
// ==================== 主控芯片选择 ====================
// 请只保留一个定义，注释掉其他两个
// #define USE_ESP32C6     // ESP32-C6
// #define USE_ESP32C5     // ESP32-C5
#define USE_ESP32C3        // ESP32-C3
// ======================================================
```

### 2. 编译和上传

1. 使用 Arduino IDE 或 PlatformIO 打开项目
2. 选择对应的开发板
3. 编译并上传到目标芯片

### 3. 查看输出

打开串口监视器（波特率：115200），你将看到类似以下输出：

```
========================================
SC7U22 IMU 原始数据测试
========================================
主控芯片: ESP32-C3
SPI 引脚 - MOSI: 7, MISO: 2, SCK: 6, CS: 10
========================================

[SPI] 初始化完成
[SPI] 时钟频率: 8 MHz
[SPI] MISO 上拉已启用

正在初始化 SC7U22 (SPI)...
尝试 SPI MODE0...
SC7U22 芯片 ID: 0x6A
MODE0 成功!
SC7U22 配置完成！
加速度计: ±8G, 1600Hz
陀螺仪: ±2000°/s, 1600Hz

========================================
开始输出原始数据
========================================

[原始] ACC: -245, 123, 16384 | GYR: 12, -35, 8 | ACC(G): -0.060, 0.030, 4.000 | GYR(°/s): 0.73, -2.14, 0.49 | 样本: 1
[原始] ACC: -248, 125, 16380 | GYR: 10, -33, 6 | ACC(G): -0.061, 0.031, 3.999 | GYR(°/s): 0.61, -2.01, 0.37 | 样本: 2
...
```

## 📊 输出数据说明

每行输出包含以下信息：

- **原始数据 (ACC/GYR)**: 16 位有符号整数值，范围 -32768 ~ 32767
- **物理单位 (ACC(G))**: 加速度，单位为 G (重力加速度)
- **物理单位 (GYR(°/s))**: 角速度，单位为 度/秒
- **样本计数**: 累计采样次数

### 数据格式
```
[原始] ACC: X, Y, Z | GYR: X, Y, Z | ACC(G): X, Y, Z | GYR(°/s): X, Y, Z | 样本: N
```

## 🔍 功能特性

- ✅ 自动检测并选择最佳 SPI 模式 (MODE0/1/2/3)
- ✅ 完整的 SPI 初始化序列（支持从 I2C 切换到 SPI）
- ✅ 芯片 ID 验证
- ✅ 软复位和传感器配置
- ✅ 数据就绪检测
- ✅ 原始数据和物理单位同步输出
- ✅ 采样计数器
- ✅ 多平台支持（ESP32-C3/C5/C6）

## 🛠️ 故障排除

### 1. 芯片 ID 读取失败

**症状**: 串口输出 "错误: 所有 SPI 模式都失败"

**解决方法**:
- 检查硬件连接是否正确
- 确认 VCC 为 3.3V
- 确认 GND 已共地
- 测量各引脚是否有电压波动
- 尝试降低 SPI 时钟频率（修改 `SPI_CLOCK` 为 1000000 或更低）

### 2. 数据读取超时

**症状**: 串口输出 "[错误] 数据读取超时！"

**解决方法**:
- 检查传感器电源是否稳定
- 确认传感器配置是否成功
- 尝试增加延迟时间

### 3. COM_CFG 寄存器值异常

**症状**: "COM_CFG 寄存器值不正确！"

**解决方法**:
- 增加软复位后的延迟时间
- 检查 SPI 通信质量
- 尝试重新上电

## 📚 技术参考

### 关键寄存器

| 寄存器 | 地址 | 功能 |
|--------|------|------|
| WHO_AM_I | 0x01 | 芯片 ID (应为 0x6A) |
| PWR_CTRL | 0x7D | 电源控制 |
| SOFT_RESET | 0x4A | 软复位 |
| COM_CFG | 0x04 | 通信配置 |
| ACC_CONF | 0x40 | 加速度计配置 |
| ACC_RANGE | 0x41 | 加速度计量程 |
| GYR_CONF | 0x42 | 陀螺仪配置 |
| GYR_RANGE | 0x43 | 陀螺仪量程 |
| STATUS | 0x0B | 状态寄存器 |
| ACC_X_LSB | 0x0C | 加速度数据起始地址 |

### SPI 配置
- **时钟频率**: 8MHz
- **模式**: MODE0 (CPOL=0, CPHA=0)
- **字节序**: MSB First
- **读操作**: 寄存器地址 | 0x80
- **写操作**: 寄存器地址 & 0x7F

## 📝 版本历史

- **2026-02-07**: 初始版本
  - 支持 ESP32-C3/C5/C6
  - 实现基本数据读取功能
  - 添加自动 SPI 模式检测

## 📄 许可证

本项目采用开源许可证（具体许可证类型请参考项目根目录）。

## 🔗 相关链接

- [SC7U22 数据手册](https://www.sinowealth.com/)
- [ESP32-C3 技术文档](https://www.espressif.com/zh-hans/products/socs/esp32-c3)
- [ESP32-C6 技术文档](https://www.espressif.com/zh-hans/products/socs/esp32-c6)
